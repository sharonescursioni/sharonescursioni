YUI.add("flickr-getty-search-fetcher",(function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-getty-search"]={run:function(o,t){var a=this,s=this._processParams(o,t);return e.Promise.all([t.callAPI("flickr.getty.affiliate.search",s),t.getModelRegistry("getty-search-models")]).then((function(e){return a._processResponse(e,o,t)}),e.FetcherErrorLogger(r))},_processParams:function(e){var r={search_phrase:e.searchTerm,color:e.color,orientations:e.orientations,accept_language:e.language,gi_country_code:e.countryCode};return e.photoId&&(r.photo_id=e.photoId),r},_processResponse:function(e,r){var o=e[0],t=e[1],a={images:o.images,searchTerm:r.searchTerm,color:r.color,orientations:r.orientations,language:r.language,countryCode:r.countryCode,photoId:r.photoId,searchPhrase:o.searchPhrase};return t.addOrUpdate(a),o}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:[]});YUI.add("getty-search-models",(function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-getty-search"].run(r,this.appContext)}},attributes:{images:{},searchTerm:{},photoId:{},color:{},orientations:{},language:{},countryCode:{},searchPhrase:{}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-getty-search-fetcher"]});YUI.add("getty-widget-view",(function(e,t){var i=new e.SubscriptionsHelper,r=require("justified-layout"),o=require("hermes-core/flog")(t);e.namespace("Views")["getty-widget-view"]=e.Base.create("getty-widget-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.justifiedLayout=r,this.params=t,this.widgetType=this.params.type,this.searchTerm=this.getSearchTerm(),this.geo=this.params.geo,this.gettyHelper=new e.GettyHelper(this.appContext,this.params),this.iStockLogoLocation=e.config.flickr.urls.assetRoot+"/images/getty/IStock_corporate_logo.svg",this.currentUrl=YUI.Env.isServer?this.appContext.request.url:e.url()+this.appContext.flapp.getPath(),this.countryCode=null,this.widgetIsInView=!1,this.widgetIsLoaded=!1,this.widgetLoadEventListener,this.bottom,this.apiFailed,this.types={searchPage:{searchTerm:this.searchTerm,layoutSpacing:4,layoutRowHeight:140,layoutRowHeightTolerance:0,layoutMaxAr:2,snowPlowLabel:"getty-search",rowCount:1,typeClass:"search-page",viewMoreFlipper:"enable-getty-view-more-search",utmOptions:{promo:{campaign:"srp_photos_top",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/plans-and-pricing"},viewMore:{campaign:"srp_photos_viewmore",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/search/2/image",extraParams:`?mediatype=photography&phrase=${this.searchTerm}`},imageAsset:{campaign:"srp_photos_top",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:""}}},photoPage:{searchTerm:"adventure",layoutSpacing:4,layoutRowHeight:120,layoutRowHeightTolerance:0,layoutMaxAr:2,snowPlowLabel:"getty-photopage",layoutContainerWidth:500,rowCount:2,typeClass:"photo-page",viewMoreFlipper:"enable-getty-view-more-photo",utmOptions:{promo:{campaign:"adp_photos_sponsored",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/plans-and-pricing"},viewMore:{campaign:"adp_photos_viewmore",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/search/2/image",extraParams:""},imageAsset:{campaign:"adp_photos_sponsored",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:""}}},trendTagsPage:{searchTerm:"nature",layoutSpacing:4,layoutRowHeight:200,layoutRowHeightTolerance:0,layoutMaxAr:1,snowPlowLabel:"getty-trend-tags-page",rowCount:1,typeClass:"default-widget-page",viewMoreFlipper:"enable-getty-view-more-search",utmOptions:{promo:{campaign:"Trending_photos_sponsored",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/plans-and-pricing"},viewMore:{campaign:"Trending_photos_viewmore",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/search/2/image",extraParams:`?mediatype=photography&phrase=${this.searchTerm}`},imageAsset:{campaign:"Trending_photos_sponsored",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:""}}},explorePage:{searchTerm:"nature",layoutSpacing:4,layoutRowHeight:200,layoutRowHeightTolerance:0,layoutMaxAr:1,snowPlowLabel:"getty-explore-page",rowCount:1,typeClass:"default-widget-page",viewMoreFlipper:"enable-getty-view-more-search",utmOptions:{promo:{campaign:"Explore_photos_sponsored",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/plans-and-pricing"},viewMore:{campaign:"Explore_photos_viewmore",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/search/2/image",extraParams:`?mediatype=photography&phrase=${this.searchTerm}`},imageAsset:{campaign:"Explore_photos_sponsored",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:""}}},tagsPage:{searchTerm:this.searchTerm,layoutSpacing:4,layoutRowHeight:200,layoutRowHeightTolerance:0,layoutMaxAr:1,snowPlowLabel:"getty-tags-page",rowCount:1,typeClass:"default-widget-page",viewMoreFlipper:"enable-getty-view-more-search",utmOptions:{promo:{campaign:"Tags_photos_sponsored",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/plans-and-pricing"},viewMore:{campaign:"Tags_photos_viewmore",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:"https://www.istockphoto.com/search/2/image",extraParams:`?mediatype=photography&phrase=${this.searchTerm}`},imageAsset:{campaign:"Tags_photos_sponsored",term:this.searchTerm,pageUrl:this.currentUrl,originalURL:""}}}},this.utmTrackingOptions=this.getUtmOptions(),this.params.geo&&this.params.geo.countryCode?this.countryCode=this.params.geo.countryCode:e.config.flickr.geo&&e.config.flickr.geo.countryCode&&(this.countryCode=e.config.flickr.geo.countryCode)},getSearchTerm:function(){return"searchPage"===this.widgetType?this.params.searchTerm:"photoPage"===this.widgetType?"adventure":"trendTagsPage"===this.widgetType||"explorePage"===this.widgetType?"nature":"tagsPage"===this.widgetType?this.params.tag:void 0},getUtmOptions:function(){return this.types[this.widgetType].utmOptions},getPhotoPageState:function(){if(YUI.Env.isServer||!this.widgetIsInView)return e.Promise.resolve();var t=this;return new e.FlickrPromise({gettyModel:t.appContext.getModel("getty-search-models",{photoId:t.params.photoId,language:t.gettyHelper.getCorrectLangFormat(),countryCode:t.countryCode})}).then((t=>{this.gettyModel=t.gettyModel,this.apiFailed=!1,this.updateSearchTerm(),e.Snowplough&&e.Snowplough.sendStructuredEvent({category:this.searchTerm,action:"gettyResultsLoad",label:this.types[this.widgetType].snowPlowLabel})})).catch((i=>{t.apiFailed=!0,e.Snowplough&&e.Snowplough.sendStructuredEvent({category:t.searchTerm,action:"gettyResultsFail",label:this.types[this.widgetType].snowPlowLabel}),o.error("Error with fetching getty-search-models",{err:i})}))},updateSearchTerm:function(){this.searchTerm=this.gettyModel.getValue("searchPhrase"),this.utmTrackingOptions.promo.term=this.searchTerm,this.utmTrackingOptions.imageAsset.term=this.searchTerm,this.utmTrackingOptions.viewMore.term=this.searchTerm,this.utmTrackingOptions.viewMore.extraParams=`?mediatype=photography&phrase=${this.searchTerm}`},getSearchState:function(){return this.appContext.getModel("getty-search-models",{searchTerm:this.searchTerm,color:this.gettyHelper.getSearchColorHex(),orientations:this.gettyHelper.getSearchOrientation(),language:this.gettyHelper.getCorrectLangFormat(),countryCode:this.countryCode}).then((t=>{this.gettyModel=t,this.apiFailed=!1,e.Snowplough&&e.Snowplough.sendStructuredEvent({category:this.searchTerm,action:"gettyResultsLoad",label:this.types[this.widgetType].snowPlowLabel})})).catch((t=>{this.apiFailed=!0,e.Snowplough&&e.Snowplough.sendStructuredEvent({category:this.searchTerm,action:"gettyResultsFail",label:this.types[this.widgetType].snowPlowLabel}),o.error("Error with fetching getty-search-models",{err:t})}))},getDefaultWidgetState:function(){return this.appContext.getModel("getty-search-models",{searchTerm:this.searchTerm,language:this.gettyHelper.getCorrectLangFormat(),countryCode:this.countryCode}).then((t=>{this.gettyModel=t,this.apiFailed=!1,e.Snowplough&&e.Snowplough.sendStructuredEvent({category:this.params.searchTerm,action:"gettyResultsLoad",label:this.types[this.widgetType].snowPlowLabel})})).catch((t=>{this.apiFailed=!0,e.Snowplough&&e.Snowplough.sendStructuredEvent({category:this.params.searchTerm,action:"gettyResultsFail",label:this.types[this.widgetType].snowPlowLabel}),o.error("Error with fetching getty-search-models",{err:t})}))},loadState:function(){return"searchPage"===this.widgetType?this.getSearchState():"photoPage"===this.widgetType?this.getPhotoPageState():["trendTagsPage","explorePage","tagsPage"].includes(this.widgetType)?this.getDefaultWidgetState():void 0},buildLayout:function(){var e,t,i=this,r=this.gettyModel.getValue("images"),o=0,s=0,a=0,n=this.types[this.widgetType].rowCount;if(r){t=this.types[this.widgetType].layoutContainerWidth?this.types[this.widgetType].layoutContainerWidth:80*this.appContext.viewportData.getWidth()/100;var h=r.map((function(e){return Math.min(Number(parseFloat(e.maxDimensions.width/e.maxDimensions.height).toFixed(2)),i.types[i.widgetType].layoutMaxAr)}));return"searchPage"===this.widgetType&&this.appContext.flipper.isFlipped("enable-search-sidebar")&&this.appContext.viewportData.getWidth()>1080&&(t-=340),(e=i.justifiedLayout(h,{containerWidth:t,containerPadding:0,forceAspectRatio:1,boxSpacing:{horizontal:this.types[this.widgetType].layoutSpacing,vertical:this.types[this.widgetType].layoutSpacing},targetRowHeight:this.types[this.widgetType].layoutRowHeight,targetRowHeightTolerance:this.types[this.widgetType].layoutRowHeightTolerance})).boxes.some((function(t,r){s<t.top&&(s=t.top,++o>=n&&(a=a||r,e.containerHeight=e.containerHeight-t.height-i.types[i.widgetType].layoutSpacing))})),a||(a=e.boxes.length),e.boxes=e.boxes.slice(0,a),e.boxes.forEach(((e,t)=>{var r=i.gettyModel.getValue("images")[t],o=this.utmTrackingOptions.imageAsset;o.originalURL=r.referenceUri,e.displayUri=r.displayUri,e.url=this.gettyHelper.appendGettyTracking(o),e.gettyImageUrl=r.referenceUri,e.caption=r.caption})),e}},buildContainer:function(){var e={apiFailed:this.apiFailed,iStockLogo:this.iStockLogoLocation,gettyPromoLink:this.gettyHelper.appendGettyTracking(this.utmTrackingOptions.promo),upgradeProLink:i.getProLandingPageUrl(i.UTM_HIDE_ADS_GETTY_SEARCH),typeClass:this.types[this.widgetType].typeClass,viewMoreFlipper:this.types[this.widgetType].viewMoreFlipper};return["searchPage","trendTagsPage","explorePage","tagsPage"].includes(this.widgetType)?(e.layout=this.apiFailed||YUI.Env.isServer?[]:this.buildLayout(),e.viewMoreLink=this.appContext.flipper.isFlipped("enable-getty-view-more-search")?this.gettyHelper.appendGettyTracking(this.utmTrackingOptions.viewMore):""):(e.layout=this.apiFailed||YUI.Env.isServer||!this.widgetIsInView?[]:this.buildLayout(),e.viewMoreLink=this.appContext.flipper.isFlipped("enable-getty-view-more-photo")?this.gettyHelper.appendGettyTracking(this.utmTrackingOptions.viewMore):""),this.setContainerWithTemplate("getty-widget",e),this},activate:function(){var t,i=this.get("container");return i&&"photoPage"===this.widgetType&&!this.widgetIsLoaded&&((t=i.previous("div"))&&(this.bottom=t.getDOMNode().getBoundingClientRect().bottom),this.widgetLoadEventListener=this.registerEventHandler(e.globalEvents.subscribe("window:scroll",this.checkIfWidgetInViewport.bind(this)))),this.buildContainer(),this.registerEventHandler(this.get("container").delegate("click",this.onGettyResultClick.bind(this),".getty-result")),this.registerEventHandler(this.get("container").delegate("click",this.onDiscountCodeClick.bind(this),".sponsor-discount-code")),this.registerEventHandler(this.get("container").delegate("click",this.onViewMoreTileClick.bind(this),".last-result-container")),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.onResize.bind(this))),this},checkIfWidgetInViewport:function(){window.scrollY+window.innerHeight>=this.bottom+200&&(e.globalEvents.unsubscribe(this.widgetLoadEventListener),this.loadWidget())},loadWidget:function(){var e=this.get("container"),t=this;e&&(this.widgetIsInView=!0,this.widgetIsLoaded=!0,this.loadState().then((function(){t.buildContainer()})))},onResize:function(){this.buildContainer()},onGettyResultClick:function(t){let i=t.currentTarget;if(e.Snowplough&&i){let t=i.getAttribute("data-g-url"),r=parseInt(i.getAttribute("data-g-index"),10)+1;e.Snowplough.sendStructuredEvent({category:this.searchTerm,action:"gettyResultClick",label:this.types[this.widgetType].snowPlowLabel,property:t,value:r})}},onDiscountCodeClick:function(){e.Snowplough&&e.Snowplough.sendStructuredEvent({category:this.searchTerm,action:"gettyDiscountCodeClick",label:this.types[this.widgetType].snowPlowLabel})},onViewMoreTileClick:function(){e.Snowplough&&e.Snowplough.sendStructuredEvent({category:this.searchTerm,action:"gettyViewMoreTileClick",label:this.types[this.widgetType].snowPlowLabel})}})}),"@VERSION@",{requires:["flickr-view","hermes-template-getty-widget","getty-helper","getty-search-models"],optionalRequires:["hermes-core"],langBundles:["common"]});YUI.add("search-photos-unified-page-view",(function(e){var i=100,s=require("hermes-core/type-validator");e.namespace("Views")[this.name]=e.Base.create("search-photos-unified-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){var s;return this.unifiedSubviewParams=i.unifiedSubviewParams||{},s=this.unifiedSubviewParams.everyone&&this.unifiedSubviewParams.everyone.fetchParams?this.unifiedSubviewParams.everyone.fetchParams.apiParams:{},this.searchUrl=new e.SearchUrl(s,this.appContext,e.SearchUrl.searchTypes.PHOTOS),i.searchPageUrl=e.url(this.searchUrl.getURL()),this.apiParams=this.searchUrl.getAPIParams(),this.advancedPanelOpen=i.openAdvanced||!1,this.isMobile=i.isMobile,this.isSearchResultsOwnerPro=!1,this.searchTerm=i.searchTerm,this.apiFailed=i.apiFailed,i.sortMenuItems=[{text:this.intlMessage({intlName:"search.RELEVANT"}),value:e.SearchHelper.API_SORT_OPTIONS.relevant,href:null,isDefault:!0},{text:this.intlMessage({intlName:"search.DATE_UPLOADED"}),value:e.SearchHelper.API_SORT_OPTIONS.dateUploaded,href:null},{text:this.intlMessage({intlName:"search.DATE_TAKEN"}),value:e.SearchHelper.API_SORT_OPTIONS.dateTaken,href:null},{text:this.intlMessage({intlName:"search.INTERESTING"}),value:e.SearchHelper.API_SORT_OPTIONS.interesting,href:null}],this.prevScrollTop=0,this.scrollDir=-1,this.railSpacerMargin=0,this.params=i,this.geo=i.geo||e.config.flickr.geo,this.gettyHelper=new e.GettyHelper(this.appContext,Object.assign(i,{isMobile:this.isMobile,geo:this.geo})),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,isSearchResults:!0},"search-subnav-slender-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"search-empty-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"search-photos-yours-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.unifiedSubviewParams.yours}},"search-photos-contacts-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.unifiedSubviewParams.contacts}},"search-photos-prints-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.unifiedSubviewParams.prints}},"search-photos-albums-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.unifiedSubviewParams.albums}},"search-slender-advanced-panel-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"search-tools-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"search-photos-everyone-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.unifiedSubviewParams.everyone}},"getty-widget-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,type:"searchPage",disabled:function(){return!this.gettyHelper.canShowWidget()}},"moola-search-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-search-ads")||this.appContext.getViewer().isPro}},"search-sidebar-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,isPhotosSearch:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-search-sidebar")||this.isMobile}},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var i=this,t={};return this.apiFailed||!this.unifiedSubviewParams?e.Promise.resolve():(this.unifiedSubviewParams.everyone&&(t.everyone=this.appContext.getModel("search-photos-lite-models",this.unifiedSubviewParams.everyone.id,this.unifiedSubviewParams.everyone.fetchParams),this.searchUrl.getAPIParams().user_id&&(this.searchUrl.getAPIParams().user_id&&s.nsid(this.searchUrl.getAPIParams().user_id)?t.isSearchResultsOwnerPro=this.appContext.getModel("person-models",this.searchUrl.getAPIParams().user_id):t.isSearchResultsOwnerPro=this.appContext.getModel("person-models",{pathAlias:this.searchUrl.getAPIParams().user_id}))),this.unifiedSubviewParams.yours&&(t.yours=this.appContext.getModel("search-photos-lite-models",this.unifiedSubviewParams.yours.id,this.unifiedSubviewParams.yours.fetchParams)),this.unifiedSubviewParams.contacts&&(t.contacts=this.appContext.getModel("search-photos-lite-models",this.unifiedSubviewParams.contacts.id,this.unifiedSubviewParams.contacts.fetchParams)),this.unifiedSubviewParams.albums&&(t.albums=this.appContext.getModel("search-sets-models",this.unifiedSubviewParams.albums.id,this.unifiedSubviewParams.albums.fetchParams)),e.FlickrPromise(t).then((function(e){i.subviewVisibility=i.determineSubviewVisibility(e),i.subviewVisibility.empty&&(e.everyone&&!e.everyone.getValue("emptyQuery")||e.albums&&!e.albums.getValue("emptyQuery"))&&(i.subviews["search-empty-view"].set("noMatchesForQuery",i.buildNoMatchesFoundMessage()),i.subviews["search-empty-view"].fire("parentViewEvent","error-msg-updated")),e.isSearchResultsOwnerPro&&(i.isSearchResultsOwnerPro=e.isSearchResultsOwnerPro.getValue("isPro"))})))},buildContainer:function(){this.appContext.getViewer();var i={showEmpty:!this.subviewVisibility||this.subviewVisibility.empty,showAlbums:this.subviewVisibility&&this.subviewVisibility.albums,showEveryones:this.subviewVisibility&&this.subviewVisibility.everyone,showContacts:this.subviewVisibility&&this.subviewVisibility.contacts,showPrints:this.subviewVisibility&&this.subviewVisibility.prints,showYours:this.subviewVisibility&&this.subviewVisibility.yours,viewingAll:this.searchUrl.getAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll),advancedPanelOpen:this.advancedPanelOpen,searchResultsOwnerIsNotPro:!this.isSearchResultsOwnerPro,showGetty:!this.subviewVisibility.empty&&this.gettyHelper.canShowWidget()};return["search-empty-view","search-photos-yours-view","search-photos-albums-view","search-photos-contacts-view","search-photos-prints-view","search-photos-everyone-view"].forEach(function(e){this.subviews[e]&&(i[e]=this.subviews[e].get("container"))}.bind(this)),this.setContainerWithTemplate("search-photos-unified-page-view",i),this},activate:function(){return this.fire("parentViewEvent","unhideFeedbackWidget"),e.later(100,this,(function(){e.use("photo-page-scrappy-view")})),this},determineSubviewVisibility:function(e){var i={everyone:!(!e.everyone||!e.everyone.getValue("totalItems")),yours:!(!e.yours||!e.yours.getValue("totalItems")),contacts:!(!e.contacts||!e.contacts.getValue("totalItems")),albums:!(!e.albums||!e.albums.getValue("totalItems")),prints:this.appContext.flipper.isFlipped("enable-prints-discovery-page")&&!this.appContext.getViewer().isPro};return this.unifiedSubviewParams&&this.unifiedSubviewParams.everyone&&this.unifiedSubviewParams.everyone.fetchParams&&this.unifiedSubviewParams.everyone.fetchParams.apiParams.similarity_id&&(i.everyone=!1),i.empty=!(i.everyone||i.yours||i.contacts||i.albums),i},buildNoMatchesFoundMessage:function(){var i,s=this.appContext.getViewer();return i=this.apiParams.user_id?s.signedIn&&this.apiParams.user_id===s.nsid?this.searchTerm?"search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_YOUR":"search.NO_MATCHES_FOR_QUERY_TERM_YOUR":this.searchTerm?"search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_USER":"search.NO_MATCHES_FOR_QUERY_TERM_USER":this.apiParams.contacts?this.searchTerm?"search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_CONTACTS":"search.NO_MATCHES_FOR_QUERY_TERM_CONTACTS":this.apiParams.group_id?this.searchTerm?"search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_GROUP":"search.NO_MATCHES_FOR_QUERY_TERM_GROUP":this.searchTerm?"search.NO_MATCHES_FOR_QUERY_TERM":"search.NO_MATCHES_FOR_QUERY",{noMatchesText:this.searchTerm?this.intlMessage({intlName:i,searchTerm:e.flutil.unescape(this.searchTerm)}):this.intlMessage({intlName:i})}},onSubviewEvent:function(e,i){if(i)switch(i[0]){case"dirty":case"search:dirty":this.get("container").addClass("dirty");break;case"bigScotch":this.bigScotch(i);break;case"footerDisplayChanged":this.fire("parentViewEvent","footerDisplayChanged");break;case"search:layoutChange":void 0!==i[1]&&this.fire("parentViewEvent","search:layoutChange",i[1]);break;case"search:startAdvancedPanelTransition":void 0!==i[1]&&this.handleAdvancedPanelTransitionStart(i[1]);break;case"search:finishAdvancedPanelTransition":void 0!==i[1]&&this.handleAdvancedPanelTransitionEnd(i[1])}},handleAdvancedPanelTransitionStart:function(s){var t=this.get("container").one("main");s?(!this.showEmpty&&e.config.win.pageYOffset>34||(t.addClass("advanced-panel-transition"),t.addClass("advanced-panel-visible"),e.flutil.onTransitionEnd(t,(function(){t.removeClass("advanced-panel-transition")}))),this.advancedPanelOpen=!0):(!this.showEmpty&&e.config.win.pageYOffset>i||(t.addClass("advanced-panel-transition"),t.removeClass("advanced-panel-visible"),e.flutil.onTransitionEnd(t,(function(){t.removeClass("advanced-panel-transition")}))),this.advancedPanelOpen=!1)},handleAdvancedPanelTransitionEnd:function(s){var t,a=this.get("container").one("main");s?!this.showEmpty&&e.config.win.pageYOffset>34&&(a.addClass("advanced-panel-visible"),window.scrollBy(0,i)):!this.showEmpty&&e.config.win.pageYOffset>i&&(t=Math.min(i,e.config.win.document.body.scrollHeight-e.config.win.innerHeight-e.config.win.pageYOffset),a.removeClass("advanced-panel-visible"),window.scrollBy(0,-t))},bigScotch:function(i){var s=i&&i[1],t=this.searchUrl.getAPIParam(e.SearchHelper.API.excludeUserId)||"";s&&(t&&(t+=","),t+=s,this.searchUrl.setAPIParam(e.SearchHelper.API.excludeUserId,t),this.appContext.flapp.navigate(this.searchUrl.getURL()))}},{ATTRS:{}})}),"@VERSION@",{requires:["url","flutil","flickr-view","flickr-promise","search-helper","hermes-template-search-photos-unified-page-view","search-subnav-slender-view","search-empty-view","search-photos-albums-view","search-photos-yours-view","search-photos-contacts-view","search-photos-prints-view","moola-search-view","search-slender-advanced-panel-view","search-photos-everyone-view","search-url","footer-full-view","querystring-stringify-simple","search-photos-lite-models","safety-level-helper","search-sidebar-view","search-tools-view","getty-widget-view"],optionalRequires:["hermes-core"],langBundles:["search"]});YUI.add("search-photos-route",(function(e,r){var a=require("hermes-core/flog")(r);function s(e){s.superclass.constructor.call(this,e)}e.Routes[this.name]=s,e.extend(s,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(r){var s,t,i,o={},c=this,l=!0,p=!0,h=!1,n={};switch(o.apiParams=this.processRequest(r),o.viewerNsid=r.probableUser||this.appContext.getViewer().nsid,o.apiParams[e.SearchHelper.UNIFIED_STATE_PARAMS.albums]&&o.apiParams[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]&&(p=!1,l=!1),r.query&&1===r.query.advanced&&(h=!0),o.apiParams[e.SearchHelper.UNIFIED_STATE_PARAMS.viewType]){case"thumbs":s=e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.thumbs;break;case"tiles":s=e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.tiles;break;case"justified":s=e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.justified}return(i=this.generateUnifiedSubviewParams(o)).everyone&&(n.everyone=this.appContext.getModel("search-photos-lite-models",i.everyone.id,i.everyone.fetchParams)),i.yours&&(n.yours=this.appContext.getModel("search-photos-lite-models",i.yours.id,i.yours.fetchParams)),i.contacts&&(n.contacts=this.appContext.getModel("search-photos-lite-models",i.contacts.id,i.contacts.fetchParams)),i.albums&&(n.albums=this.appContext.getModel("search-sets-models",i.albums.id,i.albums.fetchParams)),i.prints&&(n.prints=this.appContext.getModel("group-pool-models",i.prints.id,i.prints.fetchParams)),!s&&o.viewerNsid&&(n.viewerPrefs=this.appContext.getModel("person-preferences-models",o.viewerNsid)),t=r.query&&parseFloat(r.query.row_height)||1,t=Math.max(.5,Math.min(4,t)),e.FlickrPromise(n).then((function(a){s||(s=a.viewerPrefs?a.viewerPrefs.getValue("unifiedSearchViewPref"):e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPE_DEFAULT);var n=o.apiParams[e.SearchHelper.API.text]||o.apiParams[e.SearchHelper.API.tags],P=c.intlMessage({intlName:"search.SEARCH"});return void 0!==n&&(P+=": "+n),e.Promise.resolve({view:"search-photos-unified-page-view",params:{unifiedSubviewParams:i,searchType:e.SearchUrl.searchTypes.PHOTOS,searchTerm:n,modelParams:o,showTools:l,showAdvanced:p,openAdvanced:h,showSort:l,viewType:s,rowHeightMod:t,geo:r.geo},title:P})}),(function(r){a.error({err:r});var s=o.apiParams[e.SearchHelper.API.text]||o.apiParams[e.SearchHelper.API.tags],t=c.intlMessage({intlName:"search.SEARCH"});return void 0!==s&&(t+=": "+s),e.Promise.resolve({view:"search-photos-unified-page-view",params:{searchTerm:s,apiFailed:!0,modelParams:o},title:t})}))},generateUnifiedSubviewParams:function(r){var a,s={},t=r.apiParams;return e.SearchHelper.isParameterlessSearch(t)||(this.shouldPerformEveryoneSearch(r,t)&&(a=new e.SearchUrl(t,this.appContext,e.SearchUrl.searchTypes.PHOTOS),s.everyone={id:a.getId(),fetchParams:{apiParams:a.getAPIParams(),perPage:25}}),this.shouldPerformYoursSearch(r,t)&&(a=new e.SearchUrl(e.merge({user_id:r.viewerNsid,sort:e.SearchHelper.API_SORT_OPTIONS.dateTaken},t),this.appContext,e.SearchUrl.searchTypes.PHOTOS),s.yours={id:a.getId(),fetchParams:{apiParams:a.getAPIParams(),perPage:20}}),this.shouldPerformContactsSearch(r,t)&&(a=new e.SearchUrl(e.merge(t,{contacts:"all"}),this.appContext,e.SearchUrl.searchTypes.PHOTOS),s.contacts={id:a.getId(),fetchParams:{apiParams:a.getAPIParams(),perPage:20}}),this.shouldPerformAlbumsSearch(r,t)&&(a=new e.SearchUrl(e.merge(t,{user_id:r.viewerNsid}),this.appContext,e.SearchUrl.searchTypes.PHOTOS),s.albums={id:a.getId(),fetchParams:{apiParams:a.getAPIParams(),perPage:20}}),this.appContext.flipper.isFlipped("enable-prints-discovery-page")&&(a=new e.SearchUrl(t,this.appContext,e.SearchUrl.searchTypes.PHOTOS),s.prints={id:e.config.flickr.flickrprints.printsDiscoveryGroupId,fetchParams:{apiParams:{id:e.config.flickr.flickrprints.printsDiscoveryGroupId,page:1,perPage:20},perPage:20}})),s},shouldPerformEveryoneSearch:function(r,a){return!(a[e.SearchHelper.UNIFIED_STATE_PARAMS.albums]&&a[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll])},shouldPerformYoursSearch:function(r,a){return r.viewerNsid&&!a[e.SearchHelper.API.userId]&&!a[e.SearchHelper.API.groupId]&&!a[e.SearchHelper.API.contacts]&&!a[e.SearchHelper.API.faves]&&!a[e.SearchHelper.API.similarityId]&&!a[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]},shouldPerformContactsSearch:function(r,a){return r.viewerNsid&&!a[e.SearchHelper.API.userId]&&!a[e.SearchHelper.API.groupId]&&!a[e.SearchHelper.API.contacts]&&!a[e.SearchHelper.API.faves]&&!a[e.SearchHelper.API.similarityId]&&!a[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]},shouldPerformAlbumsSearch:function(r,a){return!(!r.viewerNsid||!a[e.SearchHelper.API.text])&&(!parseInt(a[e.SearchHelper.API.marketplace])&&(!!a[e.SearchHelper.UNIFIED_STATE_PARAMS.albums]||!(a[e.SearchHelper.API.userId]||a[e.SearchHelper.API.groupId]||a[e.SearchHelper.API.contacts]||a[e.SearchHelper.API.faves]||a[e.SearchHelper.API.similarityId]||a[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll])))},processRequest:function(r){var a={};return a=e.merge(r.query,e.SearchHelper.mapRouteParamsToAPI(r.params)),a=e.SearchHelper.mapClassicSearchToAPI(a,this.appContext),e.SearchHelper.addParamDefaults(a),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(a),a}}),e.mix(s.prototype,e.Localizable)}),"@VERSION@",{requires:["flickr-route","flickr-promise","search-helper","localizable","search-photos-lite-models","search-sets-models","url","search-url","search-photos-unified-page-view","person-preferences-models"],optionalRequires:["hermes-core"],langBundles:["search"]});