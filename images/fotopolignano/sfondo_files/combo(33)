YUI.add("hermes-template-stats-rail-card",(function(t,n){var l=t.Template.Handlebars.revive({1:function(t,n,l,a,e){var s,i=null!=n?n:t.nullContext||{},r=t.hooks.helperMissing,o="function",c=t.escapeExpression,d=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t<div class="stats-rail-card pro">\n\t\t<h2 class="title">\n\t\t\t<div role="button" class="stats-filter-menu-button">\n\t\t\t\t<span class="filter-menu-text">'+c(typeof(s=null!=(s=d(l,"filterName")||(null!=n?d(n,"filterName"):n))?s:r)===o?s.call(i,{name:"filterName",hash:{},data:e,loc:{start:{line:5,column:35},end:{line:5,column:49}}}):s)+'</span>\n\t\t\t\t<span class="arrow">\n\t\t\t\t\t<svg class="icon icon-dropdown_arrow"><use xlink:href="#icon-dropdown_arrow"></use></svg>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</h2>\n\t\t<div class="content-container hidden invisible">\n\t\t\t<div class="details-container">\n\t\t\t\t<div class="count-container">\n\t\t\t\t\t<a href="'+c(typeof(s=null!=(s=d(l,"statsUrl")||(null!=n?d(n,"statsUrl"):n))?s:r)===o?s.call(i,{name:"statsUrl",hash:{},data:e,loc:{start:{line:14,column:14},end:{line:14,column:26}}}):s)+'" class="count-text">'+c(typeof(s=null!=(s=d(l,"viewCount")||(null!=n?d(n,"viewCount"):n))?s:r)===o?s.call(i,{name:"viewCount",hash:{},data:e,loc:{start:{line:14,column:47},end:{line:14,column:60}}}):s)+'</a>\n\t\t\t\t</div>\n\t\t\t\t<a href="'+c(typeof(s=null!=(s=d(l,"statsUrl")||(null!=n?d(n,"statsUrl"):n))?s:r)===o?s.call(i,{name:"statsUrl",hash:{},data:e,loc:{start:{line:16,column:13},end:{line:16,column:25}}}):s)+'"  class="graph-container">\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div class="list-container">\n\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="dummy-loader">\n\t\t\t<div class="details">\n\t\t\t\t<div class="left-container">\n\t\t\t\t\t<div class="box" style="width: 70px; height: 50px;"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="right-container">\n\t\t\t\t\t<div class="box" style="width: 120px; height: 52px;"></div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="row">\n\t\t\t\t<div class="box" style="width: 24%"></div>\n\t\t\t\t<div class="box" style="width: 24%"></div>\n\t\t\t\t<div class="box" style="width: 24%"></div>\n\t\t\t\t<div class="box" style="width: 24%"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n'},3:function(t,n,l,a,e){var s,i=null!=n?n:t.nullContext||{},r=t.hooks.helperMissing,o="function",c=t.escapeExpression,d=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t<div class="stats-rail-card free">\n\t\t<h2 class="title">\n\t\t\t<a href="'+c(typeof(s=null!=(s=d(l,"statsUrl")||(null!=n?d(n,"statsUrl"):n))?s:r)===o?s.call(i,{name:"statsUrl",hash:{},data:e,loc:{start:{line:45,column:12},end:{line:45,column:24}}}):s)+'">'+c(typeof(s=null!=(s=d(l,"title")||(null!=n?d(n,"title"):n))?s:r)===o?s.call(i,{name:"title",hash:{},data:e,loc:{start:{line:45,column:26},end:{line:45,column:35}}}):s)+'</a>\n\t\t</h2>\n\t\t<div class="content-container hidden invisible">\n\t\t\t<div class="details-container">\n\t\t\t\t<div class="graph-container">\n\t\t\t\t</div>\n\t\t\t\t<div class="count-container">\n\t\t\t\t\t<span class="count-text">'+c(typeof(s=null!=(s=d(l,"viewCount")||(null!=n?d(n,"viewCount"):n))?s:r)===o?s.call(i,{name:"viewCount",hash:{},data:e,loc:{start:{line:52,column:30},end:{line:52,column:43}}}):s)+'</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="button-container">\n\t\t\t\t<a href="'+c(typeof(s=null!=(s=d(l,"upgradeUrl")||(null!=n?d(n,"upgradeUrl"):n))?s:r)===o?s.call(i,{name:"upgradeUrl",hash:{},data:e,loc:{start:{line:56,column:13},end:{line:56,column:27}}}):s)+'" class="butt flex hollow large">'+c((d(l,"preventOrphans")||n&&d(n,"preventOrphans")||r).call(i,(d(l,"intlMessage")||n&&d(n,"intlMessage")||r).call(i,{name:"intlMessage",hash:{intlName:"feed.GET_STATS_WITH_PRO"},data:e,loc:{start:{line:56,column:77},end:{line:56,column:125}}}),{name:"preventOrphans",hash:{},data:e,loc:{start:{line:56,column:60},end:{line:56,column:127}}}))+'</a>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="dummy-loader">\n\t\t\t<div class="details">\n\t\t\t\t<div class="left-container">\n\t\t\t\t\t<div class="box" style="width: 60px; height: 48px;"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="right-container">\n\t\t\t\t\t<div class="box" style="width: 80px; height: 48px;"></div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\t\t\t<div class="button-container">\n\t\t\t\t<div class="box" style="width: 100%; height: 48px"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n'},compiler:[8,">= 4.3.0"],main:function(t,n,l,a,e){var s,i=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return null!=(s=i(l,"if").call(null!=n?n:t.nullContext||{},null!=n?i(n,"isPro"):n,{name:"if",hash:{},fn:t.program(1,e,0),inverse:t.program(3,e,0),data:e,loc:{start:{line:1,column:0},end:{line:75,column:7}}}))?s:""},useData:!0}),a={};t.Array.each([],(function(n){var l=t.Template.get("hermes/"+n);l&&(a[n]=l)})),t.Template.register("hermes/stats-rail-card",(function(n,e){return(e=e||{}).partials=e.partials?t.merge(a,e.partials):a,l(n,e)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-stats-photo-card",(function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,l,a){return'\t\t\t\t\t<svg class="icon icon-fave"><use xlink:href="#icon-fave"></use></svg>\n'},3:function(n,t,e,l,a){return'\t\t\t\t\t<svg class="icon icon-comment"><use xlink:href="#icon-comment"></use></svg>\n'},5:function(n,t,e,l,a){return'\t\t\t\t\t<svg class="icon icon-view"><use xlink:href="#icon-view"></use></svg>\n'},compiler:[8,">= 4.3.0"],main:function(n,t,e,l,a){var o,s,i=null!=t?t:n.nullContext||{},r=n.hooks.helperMissing,c="function",u=n.escapeExpression,m=n.lambda,h=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="stats-photo-card" style="width: '+u(typeof(s=null!=(s=h(e,"width")||(null!=t?h(t,"width"):t))?s:r)===c?s.call(i,{name:"width",hash:{},data:a,loc:{start:{line:1,column:44},end:{line:1,column:53}}}):s)+"px; height: "+u(typeof(s=null!=(s=h(e,"height")||(null!=t?h(t,"height"):t))?s:r)===c?s.call(i,{name:"height",hash:{},data:a,loc:{start:{line:1,column:65},end:{line:1,column:75}}}):s)+'px;">\n\t<a class="stats-photo photo-link" href="'+u(m(null!=(o=null!=t?h(t,"photo"):t)?h(o,"url"):o,t))+'"\n\t\tstyle="background-image: url(\''+u(m(null!=(o=null!=t?h(t,"photo"):t)?h(o,"displayUrl"):o,t))+'\');">\n\n\t\t<div class="stats-photo-overlay">\n\t\t\t<span class="engagement">\n'+(null!=(o=(h(e,"ifCond")||t&&h(t,"ifCond")||r).call(i,null!=t?h(t,"engagementType"):t,"===","faves",{name:"ifCond",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:7,column:4},end:{line:9,column:15}}}))?o:"")+(null!=(o=(h(e,"ifCond")||t&&h(t,"ifCond")||r).call(i,null!=t?h(t,"engagementType"):t,"===","comments",{name:"ifCond",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:10,column:4},end:{line:12,column:15}}}))?o:"")+(null!=(o=(h(e,"ifCond")||t&&h(t,"ifCond")||r).call(i,null!=t?h(t,"engagementType"):t,"===","views",{name:"ifCond",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:13,column:4},end:{line:15,column:15}}}))?o:"")+'\t\t\t\t<span class="engagement-count">'+u((h(e,"formatNumber")||t&&h(t,"formatNumber")||r).call(i,null!=(o=null!=t?h(t,"photo"):t)?h(o,"dayCount"):o,{name:"formatNumber",hash:{},data:a,loc:{start:{line:16,column:35},end:{line:16,column:66}}}))+"</span>\n\t\t\t</span>\n\t\t</div>\n\t</a>\n</div>\n"},useData:!0}),l={};n.Array.each([],(function(t){var e=n.Template.get("hermes/"+t);e&&(l[t]=e)})),n.Template.register("hermes/stats-photo-card",(function(t,a){return(a=a||{}).partials=a.partials?n.merge(l,a.partials):l,e(t,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("stats-photo-daily-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{},attributes:{photo:{isModel:!0},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},totalViewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},faveCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},totalFaveCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},commentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},totalCommentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise"]});YUI.add("stats-popular-photos-models",(function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-stats-popular-photos"].run(e,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-stats-popular-photos"]}},stats:{},totalItems:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},missingData:{defaultValue:!1}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-stats-popular-photos-fetcher"]});YUI.add("flickr-stats-popular-photos-fetcher",(function(t,o){"use strict";var e=require("hermes-core/flog")(o);t.namespace("ListFetchers")["flickr-stats-popular-photos"]={run:function(s,r,a){var i=this;return new t.FlickrPromise({apiResponse:r.callAPI("flickr.stats.getPopularPhotos",this._processParams(s)),modelRegistry:r.getModelRegistry("stats-popular-photos-models"),personModelRegistry:r.getModelRegistry("person-models"),photoModelRegistry:r.getModelRegistry("photo-models"),photoEngagementModelRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsModelRegistry:r.getModelRegistry("photo-stats-models"),statsPhotoDailyRegistry:r.getModelRegistry("stats-photo-daily-models")}).then((function(t){return i._processResponse(t,s)}),(function(t){if(2===t.code)return e.error({err:t,id:s.id,date:s.sort}),r.getModelRegistry("stats-popular-photos-models").then((function(t){t.addOrUpdate({id:s.id,photos:[],missingData:!0})}));if(5!==t.code||a){if(5===t.code)return e.error({err:t,id:s.id,sort:s.sort}),r.getModelRegistry("stats-popular-photos-models").then((function(t){t.addOrUpdate({id:s.id,photos:[],missingData:!0})}));throw t}return e.error({err:t,id:s.id,sort:s.sort}),s.sort=null,i.run(s,r,!0)})).catch(t.FetcherErrorLogger(o))},_processResponse:function(o,e){var s,r=o.apiResponse,a=o.modelRegistry,i=o.personModelRegistry,p=o.photoModelRegistry,l=o.photoEngagementModelRegistry,d=o.photoStatsModelRegistry,n=o.statsPhotoDailyRegistry,g=[],h=0;return s={id:e.id,totalItems:r&&r.photos?r.photos.total:0},r.photos.photo.length&&(g=t.Array.map(r.photos.photo,(function(o,s){var r,a;if(null!==o.id)return a={id:(r=t.APIHelper.response.parsePhotos({photos:[o],personModelRegistry:i,photoModelRegistry:p,photoEngagementModelRegistry:l,photoStatsModelRegistry:d})[0]).id+e.date,photo:r,viewCount:o.stats.views,totalViewCount:o.stats.totalViews,faveCount:o.stats.favorites,totalFaveCount:o.stats.totalFavorites,commentCount:o.stats.comments,totalCommentCount:o.stats.totalComments},n.addOrUpdate(a);h++})),h>0&&(g=g.filter((function(t){return t})))),s.photos={perPage:r.photos.perpage,page:r.photos.page,pageContent:g,totalItems:r&&r.photos?r.photos.total-h:0},a.addOrUpdate(s),g},_processParams:function(o){return{extras:t.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage||20,page:o.page||1,date:o.date||"",sort:o.sort||"views",include_results_with_zero_sorts:1,id:o.id}}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optionalRequires:["hermes-core"],optional:["stats-popular-photos-models","person-models","photo-models","photo-engagement-models","photo-stats-models","stats-photo-daily-models"]});YUI.add("stats-helper",(function(e){"use strict";var t;t=YUI.Env.isServer?require("querystring").stringify:function(e){var t,r,a,o=[];for(t in e)if(e.hasOwnProperty(t))if(Array.isArray(e[t]))for(r=0,a=e[t].length;r<a;r++)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t][r]));else o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},e.StatsHelper=function(){},e.StatsHelper.prototype.moveToFrontOfArray=function(e,t){var r=-1;return e.forEach((function(e,a){e===t&&(r=a)})),r>-1&&e.unshift(e.splice(r,1)[0]),e},e.StatsHelper.prototype.moveToEndOfArray=function(e,t){var r=-1;return e.forEach((function(e,a){e===t&&(r=a)})),r>-1&&(e.push(e[r]),e.splice(r,1)),e},e.StatsHelper.prototype.whichChild=function(e){for(var t=0;null!==(e=e.previousElementSibling);)++t;return t},e.StatsHelper.prototype.getRoundedRectanglePath=function(e,t,r,a,o,n,s){var c,i=e[0],p=e[1],u=t[0],f=t[1];return c="M"+(i+r)+","+p,c+="h"+(u-2*r),o?c+="a"+r+","+r+" 0 0 1 "+r+","+r:(c+="h"+r,c+="v"+r),c+="v"+(f-2*r),s?c+="a"+r+","+r+" 0 0 1 "+-r+","+r:(c+="v"+r,c+="h"+-r),c+="h"+(2*r-u),n?c+="a"+r+","+r+" 0 0 1 "+-r+","+-r:(c+="h"+-r,c+="v"+-r),c+="v"+(2*r-f),a?c+="a"+r+","+r+" 0 0 1 "+r+","+-r:(c+="v"+-r,c+="h"+r),c+="z"},e.StatsHelper.prototype.getIdFromParams=function(e){var r=t(e);return""===r&&(r=1),r},e.StatsHelper.prototype.convertStorageTotalToRealNumber=function(e){var t=e;return-1===e&&(t=-1),t},e.StatsHelper.prototype.convertStorageAmountToRealNumber=function(e){var t,r,a;return e=parseInt(e,10)||1,t=Math.ceil(Math.log(e)/Math.LN10),r=Math.floor(t/3),a=e/Math.pow(10,3*r),a=Math.floor(100*a)/100},e.StatsHelper.prototype.convertNaturalLanguageDateToRealDateTimestamp=function(t,r){var a,o="";switch(a=e.moment(),r){case"today":o=a;break;case"yesterday":o=a.subtract(1,"days");break;case"thisweek":case"week":o=a.startOf("week");break;case"lastweek":o=a.subtract(1,"weeks").startOf("week");break;case"twoweeksago":case"theweekbeforethat":o=a.subtract(2,"weeks").startOf("week");break;case"threeweeksago":case"theweekbeforetheweekbeforethat":o=a.subtract(3,"weeks").startOf("week")}return""!==o&&(o=new e.TimezoneHelper(t,o.format("X"),"+00:00").toFormat("YYYY-MM-DD")),o}}),"@VERSION@",{affinity:"",requires:["flickr-promise","event-custom","moment","timezone-helper"],optional:[]});YUI.add("stats-rail-card-view",(function(t,e){var i=require("hermes-core/flog")(e),a=new t.SubscriptionsHelper;t.namespace("Views")[this.name]=t.Base.create("stats-rail-card-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.statsConfig=this.params.statsConfig,this.FILTER_TYPE_INTL={views:{intlName:"stats.RECENT_VIEWS"},faves:{intlName:"stats.RECENT_FAVES"},comments:{intlName:"stats.RECENT_COMMENTS"}},this.FILTER_TYPE_API_SORT_VALS={views:"views",faves:"favorites",comments:"comments"},this.FILTER_GRAPH_COLORS={views:{start:"#5BF4FC",end:"#33b7ff"},faves:{start:"#FF0084",end:"#93278F"},comments:{start:"#FFAA00",end:"#FB5A00"}},this.justifiedLayout=require("justified-layout"),this.statsHelper=new t.StatsHelper,this.photoCardHelper=new t.PhotoCardHelper(this.appContext),this.photoSizeHelper=new t.PhotoSizeHelper(this.appContext),this.isPro=this.appContext.getViewer().isPro,this.alreadyLoaded=!!this.statsConfig,this.statsConfig=this.statsConfig||{},this.filterType="views"},loadState:function(){var t=this;return this.appContext.getModel("person-models",this.appContext.getViewer().nsid).then((function(e){t.viewerModel=e}))},buildContainer:function(){var e=t.URLHelper.generatePersonUrls(this.viewerModel).stats,i=this.isPro?{isPro:!0,filterName:this.intlMessage(this.FILTER_TYPE_INTL[this.filterType]),statsUrl:e}:{isPro:!1,title:this.intlMessage({intlName:"feed.ALL_TIME_VIEWS"}),statsUrl:e,upgradeUrl:a.getProLandingPageUrl(a.UTM_UPSELL_LINK,{utm_medium:"stats-rail-card"})};this.setContainerWithTemplate("stats-rail-card",i)},activate:function(){var e=this,i=this.get("container");return this.isRerender||(this.isPro?t.Analytics.sendClick("Rail Card Type: Stats Pro","Rail Card Loaded"):t.Analytics.sendClick("Rail Card Type: Stats Free","Rail Card Loaded")),this.countNode=i.one(".count-text"),this.contentContainer=i.one(".content-container"),this.listContainerNode=i.one(".list-container"),this.dummyLoaderNode=i.one(".dummy-loader"),this.graphContainerNode=i.one(".graph-container"),this.currentContainerWidth=i.get("clientWidth"),this.registerEventHandler(t.globalEvents.subscribe("window:resize",t.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),this.isPro&&(this.filterMenuNode=i.one(".stats-filter-menu-button"),this.registerEventHandler(this.filterMenuNode.on("click",this.handleFilterClick.bind(this)))),(this.alreadyLoaded?t.Promise.resolve():this.loadStats()).then((function(){var i=e.isPro?e.statsConfig.dayCounts[e.filterType]:e.statsConfig.viewCount;return e.countNode.set("text",t.IntlNumber.format(i||0,e.appContext.lang,1)),e.setLoading(!1),setTimeout((function(){e.contentContainer.removeClass("invisible")}),0),e.isPro?(e.drawDailyViewsGraph(),e.buildLayout()):(e.drawIconGraph(),t.Promise.resolve())}))},buildLayout:function(){var e,i=this,a=t.Node.create('<div class="stats-layout"></div>'),s=i.statsConfig.photoItems.map((function(t){return 1})),n=this.listContainerNode.get("clientWidth"),r=0,o=0,l=0;(e=i.justifiedLayout(s,{containerWidth:n,containerPadding:0,boxSpacing:{horizontal:4,vertical:4},targetRowHeight:60,targetRowHeightTolerance:.2})).containerWidth=n,e.boxes.some((function(t,i){o<t.top&&(o=t.top,++r>=1&&(l=l||i,e.containerHeight=e.containerHeight-t.height-4))})),l||(l=e.boxes.length),e.boxes=e.boxes.slice(0,l),this.listContainerNode.appendChild(a),a.setStyle("position","relative"),a.setStyle("height",e.containerHeight),a.setStyle("width",e.containerWidth),e.boxes.forEach((function(e,s){var n,r=i.statsConfig.photoItems[s],o=t.Node.create('<div class="stats-rail-photo-item" data-photo-id="'+r.id+'"></a>'),l=i.photoSizeHelper.getSizeToFit(r.sizes,{width:e.width,height:e.height},{includeSquare:!0});n=i.templates("stats-photo-card")({width:e.width,height:e.height,engagementType:i.filterType,photo:{url:r.url,dayCount:""+r.dayCounts[i.filterType],displayUrl:l.displayUrl}}),o.setStyle("position","absolute"),o.setStyle("top",e.top),o.setStyle("left",e.left),o.append(n),a.appendChild(o)}))},loadStats:function(){var e=this,a=new t.TimezoneHelper(this.appContext,t.moment(),"+00:00").toFormat("YYYY-MM-DD"),s={date:a},n=(this.statsHelper.getIdFromParams(s),{date:a,sort:this.FILTER_TYPE_API_SORT_VALS[this.filterType]}),r={id:this.statsHelper.getIdFromParams(n)},o={},l={id:this.statsHelper.getIdFromParams(o)},d=[];return d=this.isPro?[this.appContext.getModel("stats-popular-photos-models",r,n).then((function(t){e.statsPopularPhotosModel=t,e.statsConfig.photoItems=t.getValue("photos").getList().map((function(t){var i=t.getValue("photo");return Object.assign({dayCounts:{views:parseInt(t.getValue("viewCount"),10),faves:parseInt(t.getValue("faveCount"),10),comments:parseInt(t.getValue("commentCount"),10)}},e.photoCardHelper.convertPhotoModel(i))}))})),this.appContext.getModel("stats-daily-views-models",l,o).then((function(t){var i=t.getValue("days")||{},s=Object.keys(i);e.statsConfig.graphData={},s.forEach((function(t){e.statsConfig.graphData[t]={date:i[t].date,day:i[t].day,ownerId:i[t].ownerId,comments:parseInt(i[t].comments,10),faves:parseInt(i[t].favs,10),views:parseInt(i[t].views,10)}})),e.statsConfig.dayCounts={views:a in e.statsConfig.graphData?e.statsConfig.graphData[a].views:0,faves:a in e.statsConfig.graphData?e.statsConfig.graphData[a].faves:0,comments:a in e.statsConfig.graphData?e.statsConfig.graphData[a].comments:0}})).catch((function(t){i.error("Error loading daily views",{err:t})}))]:[this.appContext.getModel("person-public-profile-models",this.appContext.getViewer().nsid,{hideStats:!1}).then((function(t){e.publicProfileModel=t,e.statsConfig.viewCount=t.getValue("totalViews")}))],t.Promise.all(d).then((function(t){e.alreadyLoaded=!0})).catch((function(t){i.error("Error loading stats",{err:t})}))},drawDailyViewsGraph:function(){var e,i,a=this,s=4,n=6,r=this.graphContainerNode.get("clientWidth"),o=this.graphContainerNode.get("clientHeight"),l=t.d3.time.format("%Y-%m-%d").parse,d=t.d3.time.scale().range([s,r-s]),h=t.d3.scale.linear().range([o-n,n]),p=t.d3.svg.axis().scale(d).orient("bottom").tickValues([]).tickSize(0),c=t.d3.svg.line().x((function(t){return d(t.date)})).y((function(t){return h(t[a.filterType])})),u=t.d3.select("."+this.get("container").getAttribute("class").trim().replace(/\s/g,".")+" .graph-container").append("svg").attr("width",r).attr("height",o).append("g"),g=this.statsConfig.graphData,f=Object.keys(this.statsConfig.graphData),m=this.FILTER_GRAPH_COLORS[this.filterType].start,C=this.FILTER_GRAPH_COLORS[this.filterType].end;f=f.slice(f.length-7,f.length),e=f.map((function(t){return{date:l(t),views:g[t].views,comments:g[t].comments,faves:g[t].faves}})),d.domain(t.d3.extent(e,(function(t){return t.date}))),h.domain([0,t.d3.max(e,(function(t){return t[a.filterType]}))]),u.append("path").attr("class","line").attr("d",c(e)).style("stroke","url(#linear-gradient)"),u.append("g").attr("class","x-axis").attr("transform","translate(0,"+(o-1)+")").call(p),u.append("circle").attr("class","dot").attr("cx",(function(t,i){return d(e[e.length-1].date)})).attr("cy",(function(t,i){return h(e[e.length-1][a.filterType])})).attr("r",3).style("stroke",C),(i=u.append("defs").append("linearGradient").attr("id","linear-gradient")).append("stop").attr("offset","0%").attr("stop-color",m),i.append("stop").attr("offset","100%").attr("stop-color",C)},drawIconGraph:function(){var e,i=5,a=5,s=this.graphContainerNode.get("clientWidth"),n=this.graphContainerNode.get("clientHeight"),r=(t.d3.time.format("%Y-%m-%d").parse,t.d3.time.scale().range([i,s-i])),o=t.d3.scale.linear().range([n-a,a]),l=t.d3.svg.line().x((function(t,e){return r(e)})).y((function(t,e){return o(t)})),d=t.d3.select("."+this.get("container").getAttribute("class").trim().replace(/\s/g,".")+" .graph-container").append("svg").attr("width",s).attr("height",n).append("g"),h=[.2,.7,0,1],p=["#5BF4FC","#4DDFFD","#40CBFE","#33b7ff"];r.domain(t.d3.extent(h,(function(t,e){return e}))),o.domain([0,t.d3.max(h,(function(t,e){return t}))]),d.append("path").attr("class","line").attr("d",l(h)).style("stroke","url(#linear-gradient)"),h.forEach((function(t,e){d.append("circle").attr("class","dot").attr("cx",(function(){return r(e)})).attr("cy",(function(){return o(t)})).attr("r",5).style("fill",p[e])})),(e=d.append("defs").append("linearGradient").attr("id","linear-gradient")).append("stop").attr("offset","0%").attr("stop-color",p[0]),e.append("stop").attr("offset","100%").attr("stop-color",p[3])},setLoading:function(t){this.contentContainer.removeClass("hidden"),this.dummyLoaderNode.addClass("hidden")},handlePageResize:function(){var t=this.get("container").get("clientWidth");t!==this.currentContainerWidth&&(this.currentContainerWidth=t,this.rerender())},rerender:function(){this.isRerender=!0,this.detachRegisteredEvents(),this.buildContainer(),this.activate()},handleFilterClick:function(){var e=this,i=new t.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,preferBottom:!0,anchorElement:this.filterMenuNode.one(".arrow"),keyboardAnchorElement:this.filterMenuNode,closeOnScroll:!0,menuItems:[{text:this.intlMessage(this.FILTER_TYPE_INTL.views),value:"views",isSelected:"views"===this.filterType},{text:this.intlMessage(this.FILTER_TYPE_INTL.faves),value:"faves",isSelected:"faves"===this.filterType},{text:this.intlMessage(this.FILTER_TYPE_INTL.comments),value:"comments",isSelected:"comments"===this.filterType}]});i.show(),this.registerEventHandler(i.on("selected",(function(a){a&&a.menuItem&&(e.filterMenuNode.one(".filter-menu-text").set("text",e.intlMessage(e.FILTER_TYPE_INTL[a.menuItem.value])),t.Analytics.sendClick("Stats Rail Filter Type Changed: "+a.menuItem.value),e.filterType=a.menuItem.value),i.close(),e.contentContainer.addClass("invisible"),setTimeout((function(){e.alreadyLoaded=!1,e.rerender()}),300)})),this)}})}),"@VERSION@",{requires:["flickr-view","photo-card-view","hermes-template-stats-rail-card","hermes-template-stats-photo-card","stats-popular-photos-models","stats-helper","timezone-helper","url-helper","subscriptions-helper","moment"],optionalRequires:["d3","hermes-core"],langBundles:["common","feed","stats"]});YUI.add("hermes-lang-stats_it-it",(function(e,t){e.Intl.add("hermes/stats","it-IT",{STATS:[{type:0,value:"Statistiche"}],NUMBER:[{type:2,value:"num",style:null}],NUMBER_VIEWS:[{type:2,value:"num",style:null},{type:0,value:" visualizzazioni"}],NUMBER_FAVES:[{type:2,value:"num",style:null},{type:0,value:" preferiti"}],NUMBER_COMMENTS:[{type:2,value:"num",style:null},{type:0,value:" commenti"}],VIEW_COUNTS:[{type:0,value:"Numero di visualizzazioni"}],SO_FAR_TODAY:[{type:0,value:"Oggi, finora"}],SO_FAR_TODAY_DOT_DOT_DOT:[{type:0,value:"Oggi, finora..."}],YESTERDAY:[{type:0,value:"Ieri"}],ALL_TIME:[{type:0,value:"In totale"}],PHOTOS_AND_VIDEOS:[{type:0,value:"Foto e video"}],PHOTOS:[{type:0,value:"Foto"}],VIDEOS:[{type:0,value:"Video"}],PHOTOSTREAM:[{type:0,value:"Fotostream"}],ALBUMS:[{type:0,value:"Album"}],COLLECTIONS:[{type:0,value:"Raccolte"}],GALLERIES:[{type:0,value:"Gallerie"}],TOTAL:[{type:0,value:"Totale"}],TOP_PHOTOS_AND_VIDEOS:[{type:0,value:"Foto e video in primo piano"}],CONTENT_BREAKDOWN:[{type:0,value:"Dettaglio dei contenuti <span>("},{type:2,value:"num",style:null},{type:0,value:" elementi)</span>"}],VIEWS:[{type:0,value:"Visualizzazioni"}],ALL_TIME_VIEWS:[{type:0,value:"Visualizzazioni in totale"}],ALL_TIME_FAVES:[{type:0,value:"Preferiti in totale"}],ALL_TIME_COMMENTS:[{type:0,value:"Commenti in totale"}],DATE:[{type:0,value:"Data"}],INTERESTINGNESS:[{type:0,value:"Interestingness"}],FAVORITES:[{type:0,value:"Preferiti"}],COMMENTS:[{type:0,value:"Commenti"}],RECENT_VIEWS:[{type:0,value:"Visualizzazioni recenti"}],RECENT_FAVES:[{type:0,value:"Preferiti recenti"}],RECENT_COMMENTS:[{type:0,value:"Commenti recenti"}],BACK_TO_STATS:[{type:0,value:"Torna alle statistiche"}],SOURCE_BREAKDOWN:[{type:0,value:"Dettagli sulle fonti"}],ALL_PHOTO_AND_VIDEOS_LINK:[{type:0,value:"Tutte le foto e i video"}],VISITS:[{type:0,value:"Visite"}],PRO_UNTIL_DATE:[{type:0,value:"PRO fino a "},{type:1,value:"date"}],PRO_SINCE_DATE:[{type:0,value:"PRO da "},{type:1,value:"date"}],PRO_SINCE_MONTHYEAR:[{type:0,value:"PRO da "},{type:3,value:"intlDate",style:"monthYear"}],PRO_UNTIL_MONTHYEAR:[{type:0,value:"PRO fino a "},{type:3,value:"intlDate",style:"monthYear"}],LEARN_MORE:[{type:0,value:"Per saperne di più"}],CURRENT_STATS_DATE:[{type:0,value:"Le statistiche sono presentate nel fuso orario GMT, in cui al momento sono le "},{type:1,value:"time"},{type:0,value:" del "},{type:1,value:"date"}],CURRENT_STATS_LONGDATE:[{type:0,value:"Le statistiche sono presentate in GMT: al momento sono le ore "},{type:1,value:"time"},{type:0,value:" del giorno "},{type:3,value:"intlDate",style:"long"}],SPACE_USED_LIMITED:[{type:0,value:"Usati: "},{type:1,value:"used"},{type:0,value:" su "},{type:1,value:"total"},{type:0,value:" "}],SPACE_USED_UNLIMITED:[{type:0,value:"Usati: "},{type:1,value:"used"},{type:0,value:" del tuo spazio illimitato "}],PUBLIC:[{type:0,value:"Pubblica"}],FRIENDS:[{type:0,value:"Amici"}],FAMILY:[{type:0,value:"Familiari"}],FF:[{type:0,value:"Amici e familiari"}],PRIVATE:[{type:0,value:"Solo tu"}],TAGGED:[{type:0,value:"Taggati"}],GEOTAGGED:[{type:0,value:"Con geotag"}],IN_ALBUMS:[{type:0,value:"Negli album"}],IN_GROUPS:[{type:0,value:"Nei gruppi"}],VIEWED:[{type:0,value:"Visualizzati"}],FAVED:[{type:0,value:"Aggiunti ai preferiti"}],COMMENTED:[{type:0,value:"Con commenti"}],NO_SOURCES_TODAY:[{type:0,value:"Nessuna fonte per questo giorno"}],NO_VIEWS_TODAY:[{type:0,value:"Nessuna foto visualizzata oggi"}],PERCENTAGE_OF_VIEWS:[{type:2,value:"num",style:null},{type:0,value:"% di visualizzazioni"}],PERCENTAGE_OF_FAVES:[{type:2,value:"num",style:null},{type:0,value:"% di preferiti"}],PERCENTAGE_OF_COMMENTS:[{type:2,value:"num",style:null},{type:0,value:"% di commenti"}],TODAY:[{type:0,value:"Oggi"}],SOURCES:[{type:0,value:"Fonti"}],LOAD_MORE:[{type:0,value:"Carica altre"}],NEXT:[{type:0,value:"Avanti"}],PREVIOUS:[{type:0,value:"Indietro"}],MEDIA:[{type:0,value:"Multimedia"}],VISIBILITY:[{type:0,value:"Visibilità"}],ALPHA_LABEL:[{type:0,value:"Statistiche Alfa"}],BETA_LABEL:[{type:0,value:"Statistiche Beta"}],SHOW_ALL:[{type:0,value:"Mostra tutto"}],PHOTO_STATS:[{type:0,value:"Statistiche foto"}],EXPAND_ALL:[{type:0,value:"Espandi tutti"}],COLLAPSE_ALL:[{type:0,value:"Comprimi tutti"}],NO_PHOTO_STATS_AVAILABLE:[{type:0,value:"Nessuna statistica disponibile per questa foto"}],NO_RECENT_PHOTO_STATS_AVAILABLE:[{type:0,value:"Nessuna statistica recente disponibile per questa foto"}],WELCOME_TO_STATS:[{type:0,value:"Benvenuto alle statistiche"}],WELCOME_MODAL_SCREEN_1:[{type:0,value:"Visualizza facilmente tutti i tuoi dati nel tempo"}],WELCOME_MODAL_SCREEN_2:[{type:0,value:"Una navigazione migliorata"}],WELCOME_MODAL_SCREEN_3:[{type:0,value:"Dati, categorie e fonti social più pertinenti"}],WELCOME_MODAL_SCREEN_2_QUICK:[{type:0,value:"Accedi rapidamente ai tuoi dati grazie ai miglioramenti apportati alla navigazione"}],WORKING_ON_IT:[{type:0,value:"Stiamo cercando di risolvere il problema"}],STATS_LOADING:[{type:0,value:"Al momento stiamo riscontrando problemi nel mostrare queste statistiche. Riprova."}],"404_STATS_ONLY_YOU":[{type:0,value:"Spiacenti, non puoi vedere lo stato di qualcun altro."}],GET_STATS_ACCESS:[{type:0,value:"Accedi a statistiche avanzate con Flickr Pro"}],STATS_FEATURES:[{type:0,value:"Scopri quali foto sono andate in tendenza e quali hanno ottenuto più successo da quando hai creato il tuo account Flickr Pro."}],IN_DANGER_OF_LOSING_PRO:[{type:0,value:'You are in danger of losing your Pro account. <a href="'},{type:1,value:"url"},{type:0,value:'">Learn More</a>.'}]})}),"@VERSION@",{requires:["intl"]});