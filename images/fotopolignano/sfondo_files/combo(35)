YUI.add("flickr-groups-recommendations-fetcher",(function(e,r){"use strict";function o(e){return e.sample_photos_count=8,e}e.namespace("ModelFetchers")["flickr-groups-recommendations"]={run:function(s,p){var t=this,n=o({page:s.page||1,per_page:s.perPage||4,extras:(s.extras||"")+",icon_urls, sizes"});return e.Promise.all([p.callAPI("flickr.groups.recommendations",n,!0),p.getModelRegistry("group-recommended-list-models"),p.getModelRegistry("group-recommended-models")]).then((function(e){return t._processResponse(e,n,s)}),e.FetcherErrorLogger(r))},_processParams:o,_processResponse:function(r,o,s){var p=r[0].groups.group,t=r[1],n=r[2],a={},i=[];return e.each(p,(function(e){var r;e.id=e.nsid,r=n.parseGroupModel(e),n.addOrUpdate(r),i.push(n.proxy(r.id))})),a.id="none",a.groups={perPage:o.per_page,page:o.page,pageContent:i,totalItems:r[0].groups.total},t.addOrUpdate(a),i}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["group-info-models","group-models"]});YUI.add("group-recommended-list-models",(function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-groups-recommendations"].run(r,this.appContext)}},attributes:{groups:{isCollection:!0,pageFetch:{listFetcher:e.ModelFetchers["flickr-groups-recommendations"]}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-groups-recommendations-fetcher","attribute-helpers"]});YUI.add("group-recs-rail-card-view",(function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("group-recs-rail-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.groupRecs=e.groupRecs,this.justifiedLayout=require("justified-layout")},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("group-recs-rail-card",{})},activate:function(){var t=this,i=this.get("container");return this.isRerender||e.Analytics.sendClick("Rail Card Type: Group Recs","Rail Card Loaded"),this.listContainerNode=i.one(".list-container"),this.dummyLoaderNode=this.listContainerNode.one(".dummy-loader"),this.currentContainerWidth=i.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),(this.groupRecs&&this.groupRecs.length>0?e.Promise.resolve():this.loadRecs()).then((function(){return t.buildLayout()})).then((function(){t.dummyLoaderNode.addClass("hidden")}))},buildLayout:function(){var e=this;e.groupRecs.forEach((function(t){e.buildGroupLayout(t)}))},buildGroupLayout:function(e){var t=this;this.appContext.getView("group-recs-rail-item-view",Object.assign({appContext:this.appContext},e)).then((function(e){return e.initialize()})).then((function(e){return t.listContainerNode.appendChild(e.get("container")),e.activate()}))},loadRecs:function(){var e=this;return this.appContext.getModel("group-recommended-list-models",{id:"none",perPage:2}).then((function(t){e.recsModel=t,e.groupRecs=t.getValue("groups").getList().map((function(e){return Object.assign({model:e},e.toJSON())}))}))},handlePageResize:function(){var e=this.get("container").get("clientWidth");e!==this.currentContainerWidth&&(this.currentContainerWidth=e,this.rerender())},rerender:function(){this.isRerender=!0,this.detachRegisteredEvents(),this.buildContainer(),this.activate()}})}),"@VERSION@",{requires:["flickr-view","photo-card-view","group-recs-rail-item-view","hermes-template-group-recs-rail-card","hermes-template-group-recs-rail-item","hermes-template-adult-content-photo-overlay","group-recommended-list-models"],optionalRequires:["hermes-core"],langBundles:["common","adult-content-overlay","feed"]});YUI.add("hermes-template-group-discussion-rail-card",(function(t,i){var s=t.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(t,i,s,n,a){var e=t.lookupProperty||function(t,i){if(Object.prototype.hasOwnProperty.call(t,i))return t[i]};return'<div class="group-discussion-rail-card">\n\t<h2 class="title">\n\t\t<a href="/recent.gne">'+t.escapeExpression((e(s,"intlMessage")||i&&e(i,"intlMessage")||t.hooks.helperMissing).call(null!=i?i:t.nullContext||{},{name:"intlMessage",hash:{intlName:"feed.GROUP_DISCUSSIONS"},data:a,loc:{start:{line:3,column:24},end:{line:3,column:73}}}))+'</a>\n\t</h2>\n\t<div class="list-container">\n\t\t<div class="dummy-loader">\n\t\t\t<div class="row">\n\t\t\t\t<div class="attribution-section">\n\t\t\t\t\t<div class="attribution-left">\n\t\t\t\t\t\t<div class="box ava" style="height: 32px; width: 32px"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="attribution-right">\n\t\t\t\t\t\t<div class="box" style="height: 14px; width: 90%"></div>\n\t\t\t\t\t\t<div class="box" style="height: 12px; width: 60%"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="row">\n\t\t\t\t<div class="attribution-section">\n\t\t\t\t\t<div class="attribution-left">\n\t\t\t\t\t\t<div class="box ava" style="height: 32px; width: 32px"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="attribution-right">\n\t\t\t\t\t\t<div class="box" style="height: 14px; width: 80%"></div>\n\t\t\t\t\t\t<div class="box" style="height: 12px; width: 70%"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="row">\n\t\t\t\t<div class="attribution-section">\n\t\t\t\t\t<div class="attribution-left">\n\t\t\t\t\t\t<div class="box ava" style="height: 32px; width: 32px"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="attribution-right">\n\t\t\t\t\t\t<div class="box" style="height: 14px; width: 85%"></div>\n\t\t\t\t\t\t<div class="box" style="height: 12px; width: 60%"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),n={};t.Array.each([],(function(i){var s=t.Template.get("hermes/"+i);s&&(n[i]=s)})),t.Template.register("hermes/group-discussion-rail-card",(function(i,a){return(a=a||{}).partials=a.partials?t.merge(n,a.partials):n,s(i,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-group-discussion-rail-item",(function(l,n){var t=l.Template.Handlebars.revive({1:function(l,n,t,e,a){var r,o,i=null!=n?n:l.nullContext||{},s=l.hooks.helperMissing,u="function",c=l.escapeExpression,p=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'\t\t\t<a\n\t\t\t\tclass="avatar group tiny"\n\t\t\t\thref="'+c(typeof(o=null!=(o=p(t,"url")||(null!=n?p(n,"url"):n))?o:s)===u?o.call(i,{name:"url",hash:{},data:a,loc:{start:{line:6,column:10},end:{line:6,column:17}}}):o)+'"\n\t\t\t\tstyle="background-image: url('+c(l.lambda(null!=(r=null!=n?p(n,"iconUrls"):n)?p(r,"default"):r,n))+');"\n\t\t\t\tdata-group-nsid="'+c(typeof(o=null!=(o=p(t,"groupId")||(null!=n?p(n,"groupId"):n))?o:s)===u?o.call(i,{name:"groupId",hash:{},data:a,loc:{start:{line:8,column:21},end:{line:8,column:32}}}):o)+'"></a>\n'},3:function(l,n,t,e,a){var r=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return"\t\t\t\t\t"+l.escapeExpression((r(t,"intlMessage")||n&&r(n,"intlMessage")||l.hooks.helperMissing).call(null!=n?n:l.nullContext||{},{name:"intlMessage",hash:{time:null!=n?r(n,"time"):n,intlName:null!=n?r(n,"intlName"):n},data:a,loc:{start:{line:18,column:5},end:{line:18,column:48}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(l,n,t,e,a){var r,o,i=null!=n?n:l.nullContext||{},s=l.lambda,u=l.escapeExpression,c=l.hooks.helperMissing,p="function",m=l.lookupProperty||function(l,n){if(Object.prototype.hasOwnProperty.call(l,n))return l[n]};return'<div class="group-discussion-rail-item">\n\t<div class="avatar-container">\n'+(null!=(r=m(t,"if").call(i,null!=n?m(n,"iconUrls"):n,{name:"if",hash:{},fn:l.program(1,a,0),inverse:l.noop,data:a,loc:{start:{line:3,column:2},end:{line:9,column:9}}}))?r:"")+'\t</div>\n\t<div class="info-container">\n\t\t<a class="subject" href="'+u(s(null!=(r=null!=n?m(n,"topic"):n)?m(r,"url"):r,n))+'">'+u(s(null!=(r=null!=n?m(n,"topic"):n)?m(r,"subject"):r,n))+'</a>\n\t\t<div class="details">\n\t\t\t<a class="group-title" href="'+u(typeof(o=null!=(o=m(t,"url")||(null!=n?m(n,"url"):n))?o:c)===p?o.call(i,{name:"url",hash:{},data:a,loc:{start:{line:14,column:32},end:{line:14,column:39}}}):o)+'">'+u(typeof(o=null!=(o=m(t,"groupName")||(null!=n?m(n,"groupName"):n))?o:c)===p?o.call(i,{name:"groupName",hash:{},data:a,loc:{start:{line:14,column:41},end:{line:14,column:54}}}):o)+'</a>\n\t\t\t<span class="details-separator">&middot;</span>\n\t\t\t<a class="timestamp" href="'+u(s(null!=(r=null!=n?m(n,"topic"):n)?m(r,"url"):r,n))+'">\n'+(null!=(r=(m(t,"friendlySinceDate")||n&&m(n,"friendlySinceDate")||c).call(i,null!=(r=null!=n?m(n,"topic"):n)?m(r,"lastPostDate"):r,!0,!0,{name:"friendlySinceDate",hash:{},fn:l.program(3,a,0),inverse:l.noop,data:a,loc:{start:{line:17,column:4},end:{line:19,column:26}}}))?r:"")+"\t\t\t</a>\n\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),e={};l.Array.each([],(function(n){var t=l.Template.get("hermes/"+n);t&&(e[n]=t)})),l.Template.register("hermes/group-discussion-rail-item",(function(n,a){return(a=a||{}).partials=a.partials?l.merge(e,a.partials):e,t(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-size-helper",(function(e,i){var n=require("hermes-core/flog")(i),t=[{name:"Square",length:75,key:"sq",suffix:"s",isSquare:!0},{name:"Large Square",length:150,key:"q",suffix:"q",isSquare:!0},{name:"Thumbnail",length:100,key:"t",suffix:"t"},{name:"Small",length:240,key:"s",suffix:"m"},{name:"Small 320",length:320,key:"n",suffix:"n"},{name:"Small 400",length:400,key:"w",suffix:"w"},{name:"Medium",length:500,key:"m",suffix:""},{name:"Medium 640",length:640,key:"z",suffix:"z"},{name:"Medium 800",length:800,key:"c",suffix:"c"},{name:"Large",length:1024,key:"l",suffix:"b"},{name:"Large 1600",length:1600,key:"h",suffix:"h"},{name:"Large 2048",length:2048,key:"k",suffix:"k"},{name:"X-Large 3K",length:3072,key:"3k",suffix:"3k"},{name:"X-Large 4K",length:4096,key:"4k",suffix:"4k"},{name:"VR 4K",length:4096,key:"f",suffix:"f",isVR:!0},{name:"X-Large 5K",length:5120,key:"5k",suffix:"5k"},{name:"X-Large 6K",length:6144,key:"6k",suffix:"6k"},{name:"Original",length:Number.MAX_VALUE,key:"o",suffix:"o",isOriginal:!0}];e.PhotoSizeHelper=function(i){return{getSizeConfig:function(e){return t.find((function(i){return i.key===e}))},getSize:function(e,i){return(i=i||[]).find((function(i){return i.key===e}))},getLargerSizeByScale:function(e,i){var n=this.getSizeConfig(e);return i=i||1.5,t.find((function(e){return!this.isASpecialSize(e)&&e.length>=i*n.length}),this)},isASpecialSize:function(e){return!!e.isSquare||(!!e.isVR||!!e.isOriginal)},getPhotoAspectRatio:function(e){var i=this.getBiggestGeneratedSize(e);return i.width/i.height},getBiggestGeneratedSize:function(e){var i,n=[];for(i in e)"o"!==i&&n.push(e[i]);return n.sort((function(e,i){return e.width<=i.width?1:-1})),n[0]},getSizeToFit:function(i,t,r){var s,u,a,h=t.width,f=t.height,g=!!r.cropToFit,o=r.includeSquare,l=r.excludeSizes||["o"],c=r.includeSizes,S=this.isPhotoSquare(i);if(void 0===r.includeSizes)try{c=Object.keys(i)}catch(e){n.warn("getSizeToFit with invalid sizes",{err:e,sizes:i})}return e.Object.each(i,(function(e,i){var n,t,r,m,k;e&&-1===l.indexOf(i)&&c.indexOf(i)>-1&&(o||!this.isSquareType(i)||S)&&(n=parseInt(e.width,10),t=parseInt(e.height,10),(g&&n>=h&&t>=f||!g&&(n>=h||t>=f))&&(r=!0),r&&(s?t<parseInt(s.height,10)&&(s=e):s=e),u?(m=parseInt(u.width,10),k=parseInt(u.height,10),(n>m||t>k)&&(u=e)):u=e),a=s||u}),this),a},isSquareType:function(e){return["sq","q"].indexOf(e)>-1},hasSquareDimensions:function(e){return parseInt(e.width,10)/parseInt(e.height,10)==1},isPhotoSquare:function(i){var n=!0;return e.Object.some(i,(function(e,i){if(e&&e.width&&e.height&&1!==parseInt(e.width,10)/parseInt(e.height,10))return n=!1,!0}),this),n},parseApiSizes:function(i,n){return e.APIHelper.response.parsePhotoSize(i,n)}}}}),"@VERSION@",{requires:["api-helper"],optionalRequires:["hermes-core"]});YUI.add("group-discussion-rail-card-view",(function(e,i){require("hermes-core/flog")(i);e.namespace("Views")[this.name]=e.Base.create("group-discussion-rail-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.params=i,this.groupItems=i.groupItems||[],this.photoSizeHelper=new e.PhotoSizeHelper(this.appContext)},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("group-discussion-rail-card",{})},activate:function(){var i=this,t=this.get("container");return this.isRerender||e.Analytics.sendClick("Rail Card Type: Group Discussion","Rail Card Loaded"),this.dummyLoaderNode=t.one(".dummy-loader"),this.listContainerNode=t.one(".list-container"),this.currentContainerWidth=t.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),(this.groupItems&&this.groupItems.length>0?e.Promise.resolve():this.loadDiscussions()).then((function(){i.buildLayout(i.groupItems)})).then((function(){i.dummyLoaderNode.addClass("hidden")}))},buildLayout:function(e){var i=this;e.forEach((function(e){var t=i.templates("group-discussion-rail-item")(e);i.listContainerNode.appendChild(t)}))},loadDiscussions:function(){var i=this;return this.appContext.callAPI("flickr.groups.discuss.getRecentTopics",{group_count:3,topic_count:1,extras:"icon_urls"}).then((function(t){t&&t.groups&&t.groups.forEach((function(t){if(t.topics){var s=t.topics[0],r=t.pathAlias||t.id,n={id:e.guid(),groupId:t.id,groupName:t.name._content,iconUrls:t.iconurls,url:"/groups/"+r,topic:{id:s.id,subject:s.subject,lastPostDate:s.datelastpost,url:"/groups/"+r+"/discuss/"+s.id}};i.groupItems.push(n)}}))}))},handlePageResize:function(){var e=this.get("container").get("clientWidth");e!==this.currentContainerWidth&&(this.currentContainerWidth=e,this.rerender())},rerender:function(){this.isRerender=!0,this.detachRegisteredEvents(),this.buildContainer(),this.activate()}})}),"@VERSION@",{requires:["flickr-view","hermes-template-group-discussion-rail-card","hermes-template-group-discussion-rail-item","photo-size-helper"],optionalRequires:["hermes-core"],langBundles:["common","feed","relative-dates"]});