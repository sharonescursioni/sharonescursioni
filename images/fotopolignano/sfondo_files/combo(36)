YUI.add("hermes-template-explore-rail-card",(function(t,e){var a=t.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(t,e,a,s,l){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="explore-rail-card">\n\t<h2 class="title">\n\t\t<a href="/explore">'+t.escapeExpression((i(a,"intlMessage")||e&&i(e,"intlMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlMessage",hash:{intlName:"feed.EXPLORE_POPULAR_PHOTOS"},data:l,loc:{start:{line:3,column:21},end:{line:3,column:75}}}))+'</a>\n\t</h2>\n\t<div class="list-container">\n\t\t<div class="dummy-loader">\n\t\t\t<div class="row">\n\t\t\t\t<div class="box" style="width: 40%"></div>\n\t\t\t\t<div class="box" style="width: 25%"></div>\n\t\t\t\t<div class="box" style="width: 30%"></div>\n\t\t\t</div>\n\t\t\t<div class="row">\n\t\t\t\t<div class="box" style="width: 25%"></div>\n\t\t\t\t<div class="box" style="width: 30%"></div>\n\t\t\t\t<div class="box" style="width: 40%"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'},useData:!0}),s={};t.Array.each([],(function(e){var a=t.Template.get("hermes/"+e);a&&(s[e]=a)})),t.Template.register("hermes/explore-rail-card",(function(e,l){return(l=l||{}).partials=l.partials?t.merge(s,l.partials):s,a(e,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-lite-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{update:e.PhotoModelHelper.updateEngagement,addReaction:function(t){return e.ModelUpdaters["flickr-reactions-add"].run(t,this.appContext)},removeReaction:function(t){return e.ModelUpdaters["flickr-reactions-remove"].run(t,this.appContext)}},toggleFave:e.PhotoModelHelper.toggleFave,addAsFave:e.PhotoModelHelper.addAsFave,toggleReaction:function(e,t,o){var r="photo-engagement-models",i=this.getValue(e,"reactions")[t].count,a=Object.assign({},this.getValue(e,"reactions")),n=Object.assign({},a[t]);return n.didViewerReact=o,n.count=o?i+1:i-1,a[t]=n,this.setValue(e,"reactions",a),this.name!==r&&this.appContext.getModelRegistry(r).then((function(r){r.exists(e)&&r.toggleReaction(e,t,o)})),this.getValue(e,"reactions")[t]},updateReactionRemote:function(t,o){return e.Promise.resolve({})},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,attributes:{owner:{readOnly:!0,isModel:!0,getter:function(e,t){var o=this;return{id:o.getValue(t,"ownerNsid"),getValue:function(e){return"id"===e||"nsid"===e?o.getValue(t,"ownerNsid"):"url"===e?o.getValue(t,"ownerUrl"):o.getValue(t,e)},toJSON:function(){return{id:o.getValue(t,"ownerNsid"),url:o.getValue(t,"ownerUrl"),pathAlias:o.getValue(t,"pathAlias"),username:o.getValue(t,"username"),realname:o.getValue(t,"realname"),displayname:o.getValue(t,"displayname"),nsid:o.getValue(t,"ownerNsid"),ownerUrl:o.getValue(t,"ownerUrl"),isMe:o.getValue(t,"isMe")}},exists:function(e){return!1}}}},pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,ownerUrl:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,engagement:{readOnly:!0,isModel:!0,getter:function(e,t){var o=this;return{registry:this,getValue:function(e){return o.getValue(t,e)},toJSON:function(){return{ownerNsid:o.getValue(t,"ownerNsid"),isFaved:o.getValue(t,"isFaved"),faveCount:o.getValue(t,"faveCount"),commentCount:o.getValue(t,"commentCount"),canFave:o.getValue(t,"canFave"),reactions:o.getValue(t,"reactions")}},exists:function(e){return!1}}}},ownerNsid:e.PhotoModelHelper.attributes.ownerNsid,isFaved:e.PhotoModelHelper.attributes.isFaved,faveCount:e.PhotoModelHelper.attributes.faveCount,commentCount:e.PhotoModelHelper.attributes.commentCount,canFave:e.PhotoModelHelper.attributes.canFave,title:e.PhotoModelHelper.attributes.title,description:e.PhotoModelHelper.attributes.description,mediaType:e.PhotoModelHelper.attributes.mediaType,contentType:e.PhotoModelHelper.attributes.contentType,license:e.PhotoModelHelper.attributes.license,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,oWidth:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},oHeight:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},reactions:{defaultValue:{like:{id:"like",count:5,didViewerReact:!0,canReact:!0},someOtherReaction:{id:"someOtherReaction",count:3,didViewerReact:!1,canReact:!0}},derivedBy:["canFave"],getter:function(e,t){var o=this.getValue(t,"canFave");return e&&e.like&&(e.like.canReact=o,e.like.didViewerReact=!!o&&e.like.didViewerReact),e}}}})}),"@VERSION@",{requires:["flickr-model-registry","photo-model-helper","person-model-helper","flickr-favorites-add-updater","flickr-favorites-remove-updater","photo-models","photo-engagement-models","person-models"]});YUI.add("flickr-explore-getContext-fetcher",(function(e,o){"use strict";e.namespace("ListFetchers")["flickr-explore-getContext"]={run:function(t,r){var s=this;return e.Promise.all([r.callAPI("flickr.explore.getContext",this._processParams(t),!0),r.getModelRegistry("explore-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models")]).then((function(e){return s._processResponse(e,t)}),(function(e){throw 1===e.code&&"Photo not in explore"===e.message&&(e.notInContext=!0),e})).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){return{photo_id:o.photoId,extras:e.APIHelper.request.getRebootPhotoExtras(),num_prev:o.numPrev,num_next:o.numNext,date:o.date}},_processResponse:function(o,t){var r,s,n,p,l,a,i,h,d=o[0],g=o[1],u=o[2],m=o[3],x=o[4],c=o[5],y=[],M=u.proxy(t.photoId);return s=d.nextphotos,n=d.prevphotos,r=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:m,photoModelRegistry:u,photoEngagementModelRegistry:x,photoStatsModelRegistry:c}),y=e.APIHelper.response.parsePhotos({photos:n.photo,personModelRegistry:m,photoModelRegistry:u,photoEngagementModelRegistry:x,photoStatsModelRegistry:c}),l=!!(i=g.getValue(t.id,"photoContextList")).hasMinBoundary&&i.hasMinBoundary(),a=!!i.hasMaxBoundary&&i.hasMaxBoundary(),p=i.getList(),h=e.APIHelper.response.addOrReplaceListByContext({model:M,next:r,prev:y.reverse(),current:p,hasMin:l,hasMax:a,numNext:t.numNext,numPrev:t.numPrev}),g.setValue(t.id,"photoContextList",h),{next:r,previous:y.reverse()}}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["explore-models","photo-models","photo-engagement-models","photo-stats-models"]});YUI.add("explore-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,langBundles:this.details.langBundles,remote:{read:function(t){return e.ListFetchers["flickr-interestingness-getList"].run(t,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-interestingness-getList"]}},totalItems:{defaultValue:0,setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-explore-getContext"],listItemIdField:"photoId"}},displayType:{readOnly:!0,defaultValue:"explore"},url:{readOnly:!0,defaultFn:function(e){return"/explore/"+e.replace(/-/g,"/")}},urlSuffix:{readOnly:!0,defaultFn:function(e){return"explore-"+e}},title:{readOnly:!0,defaultFn:function(t){return this.intlMessage({intlName:"models.EXPLORE_TITLE",date:e.moment(t,"YYYY-MM-DD").toDate()})}}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-interestingness-getList-fetcher","flickr-explore-getContext-fetcher","moment"],langBundles:["models"]});YUI.add("flickr-interestingness-getList-fetcher",(function(e,t){e.namespace("ListFetchers")["flickr-interestingness-getList"]={run:function(o,r){var s,p=this,i=this._processParams(o,r);return s=[r.callAPI("flickr.interestingness.getList",i),r.getModelRegistry("explore-models"),r.getModelRegistry("photo-lite-models")],e.Promise.all(s).then((function(e){return p._processResponse(e,o)}),e.FetcherErrorLogger(t))},_processParams:function(t,o){var r;return r={extras:e.APIHelper.request.getRebootPhotoLiteExtras(),per_page:t.perPage||100,page:t.page||"1",date:t.id},o.flipper.isFlipped("enable-explore-v2-api")&&(r.version="v2"),e.merge(r,t.apiParams||{})},_processResponse:function(t,o){var r,s,p=t[0],i=t[1],a=t[2],n={id:o.id};if(!o.id)throw new ReferenceError("No `id` provided by request.");if(!p.photos||!p.photos.photo)throw new Error("No `photos.photo` property returned by API.");return r=p.photos.photo.map((function(t){return s=e.APIHelper.response.parsePhotoLite(t),a.addOrUpdate(s)})),n.photos={perPage:p.photos.perpage,page:p.photos.page||1,pageContent:r,totalItems:p.photos.total,totalPages:p.photos.pages},n.totalItems=p.photos.total,i.addOrUpdate(n),n.photos.pageContent}}}),"@VERSION@",{requires:["api-helper","flickr-promise"],optional:["explore-models","photo-lite-models"]});YUI.add("explore-rail-card-view",(function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("explore-rail-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.params=t,this.justifiedLayout=require("justified-layout"),this.photoCardHelper=new e.PhotoCardHelper(this.appContext),this.photoItems=t.photoItems||[]},loadState:function(){return e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("explore-rail-card",{})},activate:function(){var t=this,i=this.get("container");return this.isRerender||e.Analytics.sendClick("Rail Card Type: Explore","Rail Card Loaded"),this.listContainerNode=i.one(".list-container"),this.dummyLoaderNode=this.listContainerNode.one(".dummy-loader"),this.currentContainerWidth=i.get("clientWidth"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(this.handlePageResize.bind(this),1e3,this,!0))),(this.photoItems&&this.photoItems.length>0?e.Promise.resolve():this.loadExplore()).then((function(){return t.buildLayout()})).then((function(){t.dummyLoaderNode.addClass("hidden")}))},buildLayout:function(){var t,i=this,o=e.Node.create('<div class="explore-layout"></div>'),n=[],r="/in/explore",a=i.photoItems.map((function(e){return Math.min(e.aspectRatio,2)})),s=0,l=0,h=0;return(t=i.justifiedLayout(a,{containerWidth:this.listContainerNode.get("clientWidth"),containerPadding:0,boxSpacing:{horizontal:4,vertical:4},targetRowHeight:70,targetRowHeightTolerance:.2})).boxes.some((function(e,i){l<e.top&&(l=e.top,++s>=2&&(h=h||i,t.containerHeight=t.containerHeight-e.height-4))})),h||(h=t.boxes.length),t.boxes=t.boxes.slice(0,h),this.listContainerNode.appendChild(o),o.setStyle("position","relative"),o.setStyle("height",t.containerHeight),t.boxes.forEach((function(e,t){var o=i.photoItems[t];n.push(i.appContext.getView("photo-card-view",{box:e,isAwakeInitially:!0,photoConfig:{photoItem:o,box:e,urlContext:r,showPhotoInterstitial:o.needsInterstitial,photoInterstitialContent:o.needsInterstitial?i.templates("adult-content-photo-overlay")({isCompact:!0,photoUrl:o.url+r}):void 0}}).then((function(e){return e.initialize()})))})),e.Promise.all(n).then((function(i){return i.forEach((function(i,n){var r=i.params.photoConfig.photoItem,a=t.boxes[n],s=i.get("container"),l=e.Node.create('<div class="explore-photo-item" data-item-id="'+r.id+'"></div>');l.setStyle("position","absolute"),l.setStyle("display","flex"),l.setStyle("flex-direction","column"),l.setStyle("top",a.top),l.setStyle("left",a.left),l.appendChild(s),o.appendChild(l),i.activate()})),o}))},loadExplore:function(){var t=this,i=e.moment.utc().subtract({days:1,hours:4}),o=[i.format("YYYY"),i.format("MM"),i.format("DD")].join("-"),n={id:o,apiParams:{date:o,page:1,per_page:15}};return this.appContext.getModel("explore-models",n).then((function(e){t.exploreModel=e,t.photoItems=e.getValue("photos").getList().map((function(e){return t.photoCardHelper.convertPhotoModel(e)}))}))},handlePageResize:function(){var e=this.get("container").get("clientWidth");e!==this.currentContainerWidth&&(this.currentContainerWidth=e,this.rerender())},rerender:function(){this.isRerender=!0,this.detachRegisteredEvents(),this.buildContainer(),this.activate()}})}),"@VERSION@",{requires:["flickr-view","photo-card-view","hermes-template-explore-rail-card","hermes-template-adult-content-photo-overlay","explore-models","moment"],optionalRequires:["hermes-core"],langBundles:["common","adult-content-overlay","feed"]});YUI.add("hermes-template-blog-rail-card",(function(e,t){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,t,a,i,l){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="blog-rail-card">\n\t<h2 class="title">\n\t\t'+e.escapeExpression((n(a,"intlMessage")||t&&n(t,"intlMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlMessage",hash:{intlName:"feed.FLICKR_BLOG"},data:l,loc:{start:{line:3,column:2},end:{line:3,column:45}}}))+'\n\t</h2>\n\n\t<div class="blog-rail-content-container hidden">\n\t\t\n\t</div>\n\t<div class="dummy-loader">\n\t\t<div class="box" style="height: 140px; width: 100%"></div>\n\t\t<div class="box" style="height: 14px; width: 100%"></div>\n\t\t<div class="box" style="height: 80px; width: 100%"></div>\n\t\t<div class="box" style="height: 14px; width: 80%"></div>\n\t</div>\n</div>\n'},useData:!0}),i={};e.Array.each([],(function(t){var a=e.Template.get("hermes/"+t);a&&(i[t]=a)})),e.Template.register("hermes/blog-rail-card",(function(t,l){return(l=l||{}).partials=l.partials?e.merge(i,l.partials):i,a(t,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});